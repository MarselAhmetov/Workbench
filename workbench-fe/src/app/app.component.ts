import { Component, OnInit } from '@angular/core';
import { UserService } from "./shared/services/user.service";
import { Store } from "@ngxs/store";
import {map, Observable} from "rxjs";

@Component({
  selector: 'app-root',
  template: `
    <div *ngIf="authenticated$ | async;else plain" id="side">
      <div class="flex flex-row">
        <div class="basis-1/5">
          <app-sidebar></app-sidebar>
        </div>
        <div class="basis-4/5" style="padding-right: 30px">
          <div>
            <p-toolbar [styleClass]="'m-1'">
              <div class="p-toolbar-group-left">
                <h1>{{ title$ | async }}</h1>
              </div>

              <div class="p-toolbar-group-right">
                <span class="mx-2">
                <a class="no-underline" routerLink="/sign-in">{{ this.userEmail$ | async }}</a>
                </span>

                <div class="mx-1">
                  <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                       xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17.675 19.7313C17.6458 19.7313 17.6021 19.7313 17.5729 19.7313C17.5292 19.7313 17.4708 19.7313 17.4271 19.7313C14.1167 19.6292 11.6375 17.0479 11.6375 13.8688C11.6375 10.6313 14.2771 7.99167 17.5146 7.99167C20.7521 7.99167 23.3917 10.6313 23.3917 13.8688C23.3771 17.0625 20.8833 19.6292 17.7188 19.7313C17.6896 19.7313 17.6896 19.7313 17.675 19.7313ZM17.5 10.1646C15.4583 10.1646 13.8104 11.8271 13.8104 13.8542C13.8104 15.8521 15.3708 17.4708 17.3542 17.5438C17.3979 17.5292 17.5438 17.5292 17.6896 17.5438C19.6438 17.4417 21.175 15.8375 21.1896 13.8542C21.1896 11.8271 19.5417 10.1646 17.5 10.1646Z"
                        fill="#2176FF"/>
                    <path
                        d="M17.5 33.1771C13.5771 33.1771 9.82915 31.7187 6.92707 29.0646C6.66457 28.8312 6.5479 28.4812 6.57707 28.1458C6.76665 26.4104 7.84582 24.7917 9.63957 23.5958C13.9854 20.7083 21.0291 20.7083 25.3604 23.5958C27.1542 24.8062 28.2333 26.4104 28.4229 28.1458C28.4667 28.4958 28.3354 28.8312 28.0729 29.0646C25.1708 31.7187 21.4229 33.1771 17.5 33.1771ZM8.86665 27.8542C11.2875 29.8812 14.3354 30.9896 17.5 30.9896C20.6646 30.9896 23.7125 29.8812 26.1333 27.8542C25.8708 26.9646 25.1708 26.1042 24.1354 25.4042C20.5479 23.0125 14.4667 23.0125 10.85 25.4042C9.81457 26.1042 9.12915 26.9646 8.86665 27.8542Z"
                        fill="#2176FF"/>
                    <path
                        d="M17.5 33.1771C8.8521 33.1771 1.82294 26.1479 1.82294 17.5C1.82294 8.85208 8.8521 1.82291 17.5 1.82291C26.1479 1.82291 33.1771 8.85208 33.1771 17.5C33.1771 26.1479 26.1479 33.1771 17.5 33.1771ZM17.5 4.01041C10.0625 4.01041 4.01044 10.0625 4.01044 17.5C4.01044 24.9375 10.0625 30.9896 17.5 30.9896C24.9375 30.9896 30.9896 24.9375 30.9896 17.5C30.9896 10.0625 24.9375 4.01041 17.5 4.01041Z"
                        fill="#2176FF"/>
                  </svg>
                </div>

                <div class="mx-2">
                  <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                       xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17.5291 29.9396C14.1312 29.9396 10.7333 29.4 7.51039 28.3208C6.28539 27.8979 5.35206 27.0375 4.94372 25.9146C4.52081 24.7917 4.66664 23.5521 5.33747 22.4437L7.01456 19.6583C7.36456 19.075 7.68539 17.9083 7.68539 17.2229V13.0083C7.68539 7.58333 12.1041 3.16458 17.5291 3.16458C22.9541 3.16458 27.3729 7.58333 27.3729 13.0083V17.2229C27.3729 17.8937 27.6937 19.075 28.0437 19.6729L29.7062 22.4437C30.3333 23.4937 30.45 24.7625 30.0271 25.9146C29.6041 27.0667 28.6854 27.9417 27.5333 28.3208C24.325 29.4 20.9271 29.9396 17.5291 29.9396ZM17.5291 5.35208C13.3146 5.35208 9.87289 8.77916 9.87289 13.0083V17.2229C9.87289 18.2875 9.43539 19.8625 8.89581 20.7812L7.21872 23.5667C6.89789 24.1062 6.81039 24.675 6.99997 25.1562C7.17497 25.6521 7.61247 26.0312 8.21039 26.2354C14.3062 28.2771 20.7666 28.2771 26.8625 26.2354C27.3875 26.0604 27.7958 25.6667 27.9854 25.1417C28.175 24.6167 28.1312 24.0479 27.8396 23.5667L26.1625 20.7812C25.6083 19.8333 25.1854 18.2729 25.1854 17.2083V13.0083C25.1854 8.77916 21.7583 5.35208 17.5291 5.35208Z"
                        fill="#2176FF"/>
                    <path
                        d="M20.2417 5.74583C20.1396 5.74583 20.0375 5.73125 19.9354 5.70208C19.5125 5.58542 19.1042 5.49792 18.7104 5.43958C17.4708 5.27917 16.275 5.36667 15.1521 5.70208C14.7438 5.83333 14.3063 5.70208 14.0292 5.39583C13.7521 5.08958 13.6646 4.65208 13.825 4.25833C14.4229 2.72708 15.8813 1.72083 17.5438 1.72083C19.2063 1.72083 20.6646 2.7125 21.2625 4.25833C21.4083 4.65208 21.3354 5.08958 21.0583 5.39583C20.8396 5.62917 20.5333 5.74583 20.2417 5.74583Z"
                        fill="#2176FF"/>
                    <path
                        d="M17.5292 33.2646C16.0854 33.2646 14.6854 32.6812 13.6646 31.6604C12.6438 30.6396 12.0604 29.2396 12.0604 27.7958H14.2479C14.2479 28.6562 14.5979 29.5021 15.2104 30.1146C15.8229 30.7271 16.6688 31.0771 17.5292 31.0771C19.3375 31.0771 20.8104 29.6042 20.8104 27.7958H22.9979C22.9979 30.8146 20.5479 33.2646 17.5292 33.2646Z"
                        fill="#2176FF"/>
                  </svg>
                </div>
                <div>
                  <s-button label="Выход" (click)="userService.logout()"></s-button>
                </div>
              </div>
            </p-toolbar>
          </div>
          <router-outlet></router-outlet>
        </div>
      </div>
    </div>

    <ng-template #plain>
      <div id="center">
        <router-outlet></router-outlet>
      </div>
    </ng-template>
  `,
  styles: [`
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;700&display=swap');
    
    :host ::ng-deep .p-toolbar {
      background: none;
      border: none;

      h1 {
        font-family: "Roboto", serif;
        font-style: normal;
        font-weight: 300;
        font-size: 40px;
        line-height: 40px;
        color: #31393C;
      }
    }
    
  `],
})
export class AppComponent {

  title$: Observable<string>;
  authenticated$: Observable<boolean>;
  userEmail$: Observable<string>;


  constructor(
      readonly userService: UserService,
      private readonly store: Store,
  ) {
    this.title$ = this.store.select(e => e.app.currentPage);
    this.authenticated$ = this.store.select(e => e.app.isAuthenticated);
    this.userEmail$ = this.store.select(e => e.app.user).pipe(
        map(u => !!u ? u.email : 'hi')
    );
  }
}
